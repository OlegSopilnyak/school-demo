<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.31.xsd"
        objectQuotingStrategy="QUOTE_ONLY_RESERVED_WORDS">
    <changeSet id="1771664687427-1" author="oleg.sopilnyak@gmail.com">
        <createTable tableName="authorities">
            <column name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_authorities"/>
            </column>
            <column name="profile_id" type="BIGINT"/>
            <column name="title" type="VARCHAR(255)"/>
            <column name="first_name" type="VARCHAR(255)"/>
            <column name="last_name" type="VARCHAR(255)"/>
            <column name="gender" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>
    <changeSet id="1771664687427-2" author="oleg.sopilnyak@gmail.com">
        <createTable tableName="courses">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_courses"/>
            </column>
            <column name="name" type="VARCHAR(255)"/>
            <column name="description" type="VARCHAR(255)"/>
            <column name="faculty_id" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet id="1771664687427-3" author="oleg.sopilnyak@gmail.com">
        <createTable tableName="faculties">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_faculties"/>
            </column>
            <column name="name" type="VARCHAR(255)"/>
            <column name="dean_id" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet id="1771664687427-4" author="oleg.sopilnyak@gmail.com">
        <createTable tableName="person_permissions">
            <column name="permission" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="person_permissions" type="SMALLINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1771664687427-5" author="oleg.sopilnyak@gmail.com">
        <createTable tableName="profile_extras">
            <column name="person_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_profile_extras"/>
            </column>
            <column name="extra_value" type="VARCHAR(255)"/>
            <column name="extra_key" type="VARCHAR(255)">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_profile_extras"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1771664687427-6" author="oleg.sopilnyak@gmail.com">
        <createTable tableName="profiles">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_profiles"/>
            </column>
            <column name="type" type="INT">
                <constraints nullable="false"/>
            </column>
            <column name="email" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="phone" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="location" type="VARCHAR(255)"/>
            <column name="photo_url" type="VARCHAR(255)"/>
            <column defaultValue="Not a Principal" name="username" type="varchar(50)"/>
            <column defaultValue="Not a Principal" name="signature" type="varchar(150)"/>
            <column defaultValue="STUDENT" name="person_role" type="varchar(50)"/>
        </createTable>
    </changeSet>
    <changeSet id="1771664687427-7" author="oleg.sopilnyak@gmail.com">
        <createTable tableName="student_course">
            <column name="fk_course" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_student_course"/>
            </column>
            <column name="fk_student" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_student_course"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1771664687427-8" author="oleg.sopilnyak@gmail.com">
        <createTable tableName="students">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_students"/>
            </column>
            <column name="profile_id" type="BIGINT"/>
            <column defaultValue="Student" name="person_first_name" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column  defaultValue="Mx" name="person_gender" type="VARCHAR(10)">
                <constraints nullable="false"/>
            </column>
            <column name="last_name" type="VARCHAR(255)"/>
            <column name="description" type="VARCHAR(255)"/>
            <column name="group_id" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet id="1771664687427-9" author="oleg.sopilnyak@gmail.com">
        <createTable tableName="students_groups">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pk_studentsgroups"/>
            </column>
            <column name="name" type="VARCHAR(255)"/>
            <column name="leader_index" type="INT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="1771664687427-10" author="oleg.sopilnyak@gmail.com">
        <addUniqueConstraint columnNames="username" constraintName="uc_profiles_username" tableName="profiles"/>
    </changeSet>
    <changeSet id="1771664687427-11" author="oleg.sopilnyak@gmail.com">
        <createIndex indexName="person_profile_id" tableName="authorities" unique="true">
            <column name="profile_id"/>
        </createIndex>
    </changeSet>
    <changeSet id="1771664687427-12" author="oleg.sopilnyak@gmail.com">
        <createIndex indexName="student_profile_id" tableName="students" unique="true">
            <column name="profile_id"/>
        </createIndex>
    </changeSet>
    <changeSet id="1771664687427-13" author="oleg.sopilnyak@gmail.com">
        <addForeignKeyConstraint baseColumnNames="faculty_id" baseTableName="courses"
                                 constraintName="FK_COURSES_ON_FACULTY" referencedColumnNames="id"
                                 referencedTableName="faculties"/>
    </changeSet>
    <changeSet id="1771664687427-14" author="oleg.sopilnyak@gmail.com">
        <addForeignKeyConstraint baseColumnNames="dean_id" baseTableName="faculties"
                                 constraintName="FK_FACULTIES_ON_DEAN" referencedColumnNames="id"
                                 referencedTableName="authorities"/>
    </changeSet>
<!--    TODO: Figure out what went wrong with constraint-->
<!--    <changeSet id="1771664687427-15" author="oleg.sopilnyak@gmail.com">-->
<!--        <addForeignKeyConstraint baseColumnNames="group_ID" baseTableName="students"-->
<!--                                 constraintName="FK_STUDENTS_ON_GROUP" referencedColumnNames="ID"-->
<!--                                 referencedTableName="students_groups"/>-->
<!--    </changeSet>-->
    <changeSet id="1771664687427-16" author="oleg.sopilnyak@gmail.com">
        <addForeignKeyConstraint baseColumnNames="permission" baseTableName="person_permissions"
                                 constraintName="fk_person_permissions_on_principal_profile_entity"
                                 referencedColumnNames="id" referencedTableName="profiles"/>
    </changeSet>
    <changeSet id="1771664687427-17" author="oleg.sopilnyak@gmail.com">
        <addForeignKeyConstraint baseColumnNames="person_id" baseTableName="profile_extras"
                                 constraintName="fk_profile_extras_on_student_profile_entity" referencedColumnNames="id"
                                 referencedTableName="profiles"/>
    </changeSet>
    <changeSet id="1771664687427-18" author="oleg.sopilnyak@gmail.com">
        <addForeignKeyConstraint baseColumnNames="fk_course" baseTableName="student_course"
                                 constraintName="fk_stucou_on_course_entity" referencedColumnNames="id"
                                 referencedTableName="courses"/>
    </changeSet>
    <changeSet id="1771664687427-19" author="oleg.sopilnyak@gmail.com">
        <addForeignKeyConstraint baseColumnNames="fk_student" baseTableName="student_course"
                                 constraintName="fk_stucou_on_student_entity" referencedColumnNames="id"
                                 referencedTableName="students"/>
    </changeSet>

</databaseChangeLog>